___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Dema - Pageview",
  "categories": ["ANALYTICS"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "Dema.ai",
    "thumbnail": "data:image/jpeg;base64,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\u003d"
  },
  "description": "Send pageview events to Dema.ai",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "demaId",
    "displayName": "Dema tracker id (ex: DV-XXXXXXXXXXXXXXXX)",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "productId",
    "displayName": "Viewed product\u0027s id",
    "simpleValueType": true,
    "canBeEmptyString": true
  }
]


___SANDBOXED_JS_FOR_SERVER___

const getEventData = require('getEventData');
const getRemoteAddress = require('getRemoteAddress');
const getCookieValues = require('getCookieValues');
const getTimestampMillis = require('getTimestampMillis');
const encodeUriComponent = require('encodeUriComponent');
const sendHttpGet = require('sendHttpGet');
const JSON = require('JSON');

const event_location = getEventData('event_location');
const params = {
  e: "pageview",
  m: JSON.stringify({
    productId: data.productId,
    ip: getRemoteAddress(),
    country: event_location ? event_location.country : "",
  }),
  u: getEventData('page_location'),
  r: getEventData('page_referrer'),
  i: data.demaId,
  v: "1.0.0",
  uid: getCookieValues('DV_TRACK')[0] || getEventData('client_id'),
  _nc: getTimestampMillis().toString(),
};

function prepareURL(params) {
  const trackerUrl = "https://tracker.dema.ai/track.js";
  const urlParams = [];
  for (var key in params) urlParams.push(key + '=' + encodeUriComponent(params[key]));
  return trackerUrl + '?' + urlParams.join('&');
}

sendHttpGet(prepareURL(params), {
  headers: {"user-agent": getEventData('user-agent')},
  timeout: 1000,
}).then((result) => data.gtmOnSuccess()).catch(() => data.gtmOnFailure());


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "read_request",
        "versionId": "1"
      },
      "param": [
        {
          "key": "requestAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "headerAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queryParameterAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "cookieNames",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "DV_TRACK"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_event_data",
        "versionId": "1"
      },
      "param": [
        {
          "key": "eventDataAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 08/02/2024, 11:53:22


